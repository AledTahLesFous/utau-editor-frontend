<app-header [isLoggedIn]="isLoggedIn"></app-header>

<div class="relative w-full min-h-screen px-6 py-12 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-800 text-center overflow-hidden">

  <!-- Container projet -->
  <div class="relative max-w-lg mx-auto mt-12 text-center font-sans p-6 rounded-3xl shadow-2xl bg-white/20 backdrop-blur-2xl border border-white/30">
    <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-6">Projet: {{ title }}</h2>

    <div *ngIf="message" class="bg-emerald-500 text-white px-4 py-2 rounded-xl shadow mb-4 animate-fade-in-out">
      {{ message }}
    </div>

    <div *ngIf="!message" class="flex flex-col gap-4">

      <!-- Vue normale -->
      <div *ngIf="!editMode" class="bg-white/30 backdrop-blur-sm p-6 rounded-2xl shadow-md">
        <p class="mb-2 text-gray-900 dark:text-white"><strong>Description:</strong> {{ description || '‚Äî' }}</p>
        <p class="mb-2 text-gray-900 dark:text-white"><strong>Tempo:</strong> {{ tempo || 120 }}</p>
        <p class="mb-4 text-gray-900 dark:text-white"><strong>Key signature:</strong> {{ key_signature || '‚Äî' }}</p>

        <button
          (click)="editMode = true"
          class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-gradient-to-r from-yellow-500 to-yellow-600 text-sm"
        >
          Modifier
        </button>
      </div>

      <!-- Mode √©dition -->
      <div *ngIf="editMode" class="bg-white/20 backdrop-blur-sm p-6 rounded-2xl shadow-md flex flex-col gap-4">
        <input
          type="text"
          [(ngModel)]="description"
          placeholder="Description"
          class="w-full p-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white/70 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-400"
        />

        <div class="flex flex-col items-center gap-2">
          <label class="text-sm font-medium text-gray-900 dark:text-white">Tempo: {{ tempo || 120 }}</label>
          <input
            type="range"
            [(ngModel)]="tempo"
            min="40"
            max="300"
            step="10"
            class="w-full h-2 rounded-lg accent-emerald-400 cursor-pointer"
          />
        </div>

        <input
          type="text"
          [(ngModel)]="key_signature"
          placeholder="Key signature"
          class="w-full p-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white/70 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-400"
        />

        <div class="flex justify-center gap-3 mt-4">
          <button
            (click)="updateProject()"
            class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-gradient-to-r from-green-500 to-emerald-500 text-sm"
          >
            Enregistrer
          </button>

          <button
            (click)="cancelEdit()"
            class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-gradient-to-r from-red-500 to-pink-500 text-sm"
          >
            Annuler
          </button>
        </div>
      </div>
    </div>

    <button
      (click)="back()"
      class="mt-6 px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-gradient-to-r from-gray-500 to-gray-600 text-sm"
    >
      Retour
    </button>
  </div>


    <!-- Container projet -->
<!-- Timeline Container -->
<div class="mt-12 relative overflow-x-auto overflow-y-hidden border border-gray-300 rounded-lg shadow bg-gray-50 dark:bg-gray-900 p-4"
     [style.height.px]="noteHeight * midiNotes.length"
     (click)="onTimelineClick($event)">

  <!-- Grid Background -->
  <div class="absolute inset-0 pointer-events-none grid-background"></div>

  <!-- Time Markers -->
  <div class="absolute top-0 left-0 right-0 flex h-6 z-20">
    <div *ngFor="let t of timeMarkers()"
         [style.left.px]="t * zoomFactor"
         class="absolute text-xs text-gray-500 dark:text-gray-400 border-l border-gray-300 dark:border-gray-600 h-full flex items-start">
      <span class="mt-1 px-1 bg-gray-50 dark:bg-gray-900">{{ t / 1000 | number:'1.0-2' }}s</span>
    </div>
  </div>

  <!-- Pitch Labels -->
  <div class="absolute left-0 top-0 h-full z-10">
    <div *ngFor="let n of midiNotes; let i = index"
         [style.height.px]="noteHeight"
         class="text-xs text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700 flex items-center justify-start px-1">
      {{ n }}
    </div>
  </div>

  <!-- Notes -->
  <div class="relative ml-10" [style.height.px]="noteHeight * midiNotes.length" style="min-width: 1000px;">
    <app-note
      *ngFor="let note of notes"
      [note]="note"
      [left]="getNoteLeft(note.start_time)"
      [top]="getNoteY(note.pitch)"
      [width]="getNoteWidth(note.duration)"
      [height]="noteHeight"
      [zoomFactor]="zoomFactor"
      [highestPitch]="highestPitch"
      [moveMode]="moveMode"
      [deleteMode]="deleteMode"
      (noteMoved)="onNoteMoved($event)"
      (noteResized)="onNoteResized($event)"
      (noteDeleted)="onNoteDeleted($event)"
    ></app-note>
  </div>
</div>

<!-- Choix du phoneme -->
<div class="flex flex-col items-center gap-2">
  <label class="text-sm font-medium text-gray-900 dark:text-white">Phon√®me</label>
  <select
    [(ngModel)]="selectedPhoneme"
    class="w-full p-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white/70 dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-emerald-400"
  >
    <option *ngFor="let phoneme of phonemes" [value]="phoneme.name">
      {{ phoneme.name }}
    </option>
  </select>
</div>
<div class="mt-6 flex gap-4 justify-center">
  <button
    (click)="initializeAudio()"
    class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-blue-500 text-sm"
  >
    üîπ Initialiser Audio
  </button>

  <button
    (click)="playAudio()"
    class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300 bg-green-500 text-sm"
  >
    ‚ñ∂Ô∏è Play
  </button>
  <button
    (click)="toggleMoveMode()"
    [class.bg-gray-700]="moveMode"
    [class.bg-gray-500]="!moveMode"
    class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300"
  >
    {{ moveMode ? 'MOVE MODE' : 'ADD MODE' }}
  </button>

  <button
    (click)="toggleDeleteMode()"
    [class.bg-red-700]="deleteMode"
    [class.bg-red-500]="!deleteMode"
    class="px-4 py-2 rounded-xl font-semibold shadow text-white hover:scale-105 transition-all duration-300"
  >
    {{ deleteMode ? 'DELETE ON' : 'DELETE OFF' }}
  </button>

  <button
    (click)="clearNotes()"
    class="px-4 py-2 rounded-xl font-semibold shadow text-white bg-yellow-500 hover:scale-105 transition-all duration-300"
  >
    CLEAR
  </button>
</div>

</div>
